---
description:
globs:
alwaysApply: false
---
# Horus: ATC Radar Simulation System - Backend Coding Rules

These rules are specific to the **Uranus (Backend)** component (`./Backend/`) and supplement the rules in `Horus/.cursor/rules/project_wide.mdc`.

## ğŸ¯ Primary Document & Focus

* **Authoritative README**: `./Backend/README.md`. All backend development must align strictly with this document.
* **Focus**: Uranus backend system (Java, Spring Boot, Clean Architecture, Conflict Alert System).

## ğŸ› ï¸ Key Sections of `Backend/README.md` for Development

Refer extensively to these sections in `./Backend/README.md`:
* "æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯"
* "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£" (Clean Architecture, Strategy, Composition)
* "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ "
* "ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ" (Domain Model, Application Services, Domain Services, Infrastructure, Interfaces)
* "APIä»•æ§˜" (including Conflict Alert API, and `UranosAPI.yml`)
* "æ–°æ©Ÿèƒ½: ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ "
* "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®æˆæœ" (`AircraftRepositoryInMemory`, Code Duplication Reduction via `MathUtils`, `StringUtils`, `PositionUtils`)
* Critically: **"å®Ÿè£…ã®æ”¹å–„ç‚¹"** (prioritized TODO list with detailed impact and implementation guidance).

## ğŸ’» Coding Guidelines & Standards

* **Architecture**: Strictly adhere to Clean Architecture, DDD, and SOLID principles as detailed in `./Backend/README.md`.
* **Utilities**: Leverage existing shared utilities (`shared/utility/MathUtils.java`, `shared/utility/StringUtils.java`, `shared/utility/PositionUtils.java`) to maintain consistency and reduce redundancy.
* **Java Version**: Reiteration of the project-wide critical constraint: **Java 21 or Java 22 ONLY**. **DO NOT USE Java 24**.
* **Gradle Version**: Gradle 8.8+ (8.8 recommended).
* **Testing**: Create and update unit and integration tests as specified, especially for domain logic, services, and the Conflict Alert feature (`*ConflictDetectorTest`, `*AircraftRepositoryInMemoryTest`).

## ğŸ”„ Update Triggers and Protocol for `./Backend/README.md`

* Any modification to Java code, Spring Boot configurations, API endpoints, domain logic (including Conflict Detection), infrastructure components, or database interactions.
* **Progress on "å®Ÿè£…ã®æ”¹å–„ç‚¹"**:
    * When a task is addressed, update its status checkbox (e.g., `[ ]` to `[x] âœ…`).
    * **Mandatory**: Record the "å®Ÿè£…å®Œäº†æ—¥".
    * **Mandatory**: Provide a concise summary under "å®Ÿè£…é …ç›®" detailing what was changed/added.
    * **Mandatory**: Summarize the "å“è³ªå‘ä¸ŠåŠ¹æœ" (e.g., performance gains, bug fixes, improved maintainability), mirroring the style of the completed "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„" entry.
    * Ensure the "å½±éŸ¿ç¯„å›²" for the item accurately lists all significantly modified or newly created files.
* Changes to performance metrics (e.g., related to `AircraftRepositoryInMemory`, conflict detection, `CommercialAircraft` optimization).
* Enhancements or modifications to the Conflict Alert System or any other core domain service.
* Updates to backend-specific setup instructions, test execution commands, or Java/Gradle version requirements (if they diverge from project-wide but still within allowed versions).
* When working on an item from "å®Ÿè£…ã®æ”¹å–„ç‚¹", explicitly follow the guidance in "æ”¹å–„é …ç›®å®Ÿè£…ã‚¬ã‚¤ãƒ‰" and use the "ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼šæ”¹å–„é …ç›®åˆ¥ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«".
## âœ¨ Specific Task Guidance (from `./Backend/README.md`)

* **Error Handling**: Now marked as implemented. New error handling must conform to existing patterns (`GlobalExceptionHandler.java`, custom exceptions under `domain/exception/`, RFC 7807 `ErrorResponse.java`).
* **`CommercialAircraft.java` Optimization**: If tasked, refer to the detailed plan in "å®Ÿè£…ã®æ”¹å–„ç‚¹" > "2. CommercialAircraft ã‚¯ãƒ©ã‚¹ã®æœ€é©åŒ– â­â­â­â­". Implement its sub-points regarding distance calculation, caching, `PositionUtils` usage, and the new `GeodeticUtils.java`.
* **API Response Time Shortening**: If tasked, refer to "å®Ÿè£…ã®æ”¹å–„ç‚¹" > "3. APIå¿œç­”æ™‚é–“ã®çŸ­ç¸® â­â­â­â­" for its scope and implementation suggestions.
* **General for "å®Ÿè£…ã®æ”¹å–„ç‚¹"**: Always consult the "é‡è¦åº¦", "å·¥æ•°", "å½±éŸ¿ç¯„å›²", "å®Ÿè£…å†…å®¹", and "å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ" for any item undertaken from this list.
