# オモテノス (Omotenus): ATCレーダーシミュレーションシステム フロントエンド

## 概要

オモテノスは、ATCレーダーシミュレーションシステム「Horus」のフロントエンドコンポーネントです。Next.js 14.2.15とTypeScriptを使用して実装されており、未来的なサイバーパンクテーマのUIとリアルタイムな航空機情報の表示を提供します。

## 技術スタック

- **フレームワーク**: Next.js 14.2.15
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS with Custom Cyber Theme
- **状態管理**: React Context API
- **ビルドツール**: esbuild

## 🎨 デザインシステム

### フューチャリスティック・サイバーテーマ

本プロジェクトでは、ATCレーダーシステムにふさわしい未来的でプロフェッショナルなデザインシステムを採用しています。

#### カラーパレット

**Cyber Colors:**
- Primary: `#0ea5e9` (電子ブルー)
- Secondary: `#0284c7` (深海ブルー)
- Accent: `#075985` (ダークブルー)

**Neon Colors:**
- Green: `#00ff88` (レーダープライマリー)
- Blue: `#00d4ff` (ネオンブルー)
- Purple: `#b347d9` (サイバーパープル)
- Pink: `#ff1cf7` (デンジャーピンク)
- Orange: `#ff6b35` (ワーニングオレンジ)

**Matrix Colors:**
- Dark: `#0d1117` (背景ダーク)
- Medium: `#161b22` (中間トーン)
- Light: `#21262d` (ライトトーン)
- Accent: `#30363d` (アクセント)

#### グラデーション

```css
/* 背景グラデーション */
cyber-gradient: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%)
neon-gradient: linear-gradient(45deg, #00ff88 0%, #00d4ff 50%, #b347d9 100%)

/* コントロール要素 */
control-gradient: linear-gradient(135deg, rgba(0,255,136,0.05) 0%, rgba(0,212,255,0.05) 100%)
button-gradient: linear-gradient(135deg, #00ff88 0%, #00d4ff 100%)
button-hover-gradient: linear-gradient(135deg, #00d4ff 0%, #b347d9 100%)

/* 状態別グラデーション */
danger-gradient: linear-gradient(135deg, #ff1cf7 0%, #ff6b35 100%)
warning-gradient: linear-gradient(135deg, #ff6b35 0%, #ffeb3b 100%)
```

#### シャドウエフェクト

```css
/* ネオングロー */
cyber: 0 0 20px rgba(0, 255, 136, 0.3)
cyber-lg: 0 0 30px rgba(0, 255, 136, 0.4)
neon: 0 0 20px rgba(0, 212, 255, 0.3)
neon-lg: 0 0 30px rgba(0, 212, 255, 0.4)

/* インセットエフェクト */
inset-cyber: inset 0 0 10px rgba(0, 255, 136, 0.2)
inset-neon: inset 0 0 10px rgba(0, 212, 255, 0.2)
```

#### 角丸とアニメーション

```css
/* 角丸 */
cyber: 0.5rem
cyber-lg: 1rem
cyber-xl: 1.5rem

/* カスタムアニメーション */
glow: 発光効果のパルス
scan: スキャンライン効果
pulse-slow: ゆっくりとしたパルス
```

### コンポーネント設計原則

1. **統一されたテーマ**: 全コンポーネントで一貫したサイバーテーマを使用
2. **インタラクティブフィードバック**: ホバー、フォーカス、アクティブ状態での視覚的フィードバック
3. **アクセシビリティ**: キーボードナビゲーションとスクリーンリーダー対応
4. **パフォーマンス**: CSS-in-JSではなくTailwindによる最適化されたスタイリング

## 環境構築

### 前提条件

- Node.js 18.0.0以上
- npm 9.0.0以上

### インストール手順

1. リポジトリのクローン
```bash
git clone https://github.com/your-username/horus.git
cd horus/Frontend
```

2. 依存関係のインストール
```bash
npm install
```

3. 環境変数の設定
```bash
cp .env.sample .env.local
```
`.env.local`ファイルを開き、以下の環境変数を設定してください：
```
NEXT_PUBLIC_SERVER_IP=localhost  # バックエンドサーバーのIPアドレス
NEXT_PUBLIC_SERVER_PORT=8080     # バックエンドサーバーのポート番号
```

4. 開発サーバーの起動
```bash
npm run dev
```

5. ブラウザでアクセス
```
http://localhost:3333
```

## プロジェクト構造

```
Frontend/
├── app/                    # Next.jsのアプリケーションルート
│   ├── controller/        # コントローラー画面
│   ├── operator/          # オペレーター画面
│   └── layout.tsx         # 共通レイアウト
├── components/            # 再利用可能なコンポーネント
│   ├── radarCanvas.tsx    # レーダー表示キャンバス
│   ├── controlAircraft.tsx # 航空機制御パネル（フューチャリスティックデザイン）
│   ├── selectFixMode.tsx  # Fix選択モード（サイバーテーマ）
│   ├── routeInfoDisplaySetting.tsx # 経路情報表示設定（カスタムチェックボックス）
│   ├── sectorSelector.tsx # セクター選択（ネオンドロップダウン）
│   ├── displayRangeSetting.tsx # 表示範囲設定（ビジュアルレンジバー）
│   └── ...
├── context/              # React Context定義
├── utility/             # ユーティリティ関数
├── tailwind.config.ts   # フューチャリスティックテーマ設定
└── public/             # 静的ファイル
```

## 主要コンポーネント

### 1. レーダー表示画面 (RadarCanvas)

航空機の位置情報をリアルタイムで表示するキャンバスコンポーネント。

**主な機能**:
- 航空機の位置表示
- 経路情報の表示
- マウスインタラクション
- ズーム/パン機能

### 2. 航空機制御パネル (ControlAircraft) 🆕

未来的なサイバーテーマで設計された航空機制御インターフェース。

**デザイン特徴**:
- グラデーション背景とネオンボーダー
- ホバー時のスケーリングとグローエフェクト
- スキャンライン動画効果
- 単位表示付きの入力フィールド

### 3. Fix選択モード (SelectFixMode) 🆕

航空機の直行指示を行うためのインターフェース。

**デザイン特徴**:
- 状態別のボタンデザイン（確認/キャンセル）
- アニメーションとトランジション効果
- フォントファミリーによる統一感

### 4. 経路情報表示設定 (RouteInfoDisplaySetting) 🆕

カスタムデザインのチェックボックスを使用した設定パネル。

**デザイン特徴**:
- カスタムチェックボックスアニメーション
- グループ化されたセクション
- ホバー時のグローエフェクト

### 5. セクター選択 (SectorSelector) 🆕

カスタムドロップダウンデザインによるセクター選択。

**デザイン特徴**:
- カスタム矢印アイコン
- ホバー時のネオンエフェクト
- フォーカス時のグラデーション背景

### 6. 表示範囲設定 (DisplayRangeSetting) 🆕

ビジュアルインジケーター付きの数値入力。

**デザイン特徴**:
- プログレスバースタイルの視覚化
- 現在値の動的表示
- スピンボタンの非表示

## 状態管理

React Context APIを使用して、以下の状態を管理しています：

1. **中心座標** (CenterCoordinateContext)
2. **表示範囲** (DisplayRangeContext)
3. **経路情報表示設定** (RouteInfoDisplaySettingContext)
4. **Fix選択モード** (SelectFixModeContext)

## API通信

バックエンドとの通信は以下のエンドポイントを使用：

- `/startGame`: シミュレーション開始
- `/inGame`: 航空機情報の取得と更新
- `/controlAircraft`: 管制指示の送信

## 開発ガイドライン

### デザインシステムの使用

1. **カラー**: `tailwind.config.ts`で定義されたカラーパレットを使用
2. **グラデーション**: 定義済みの背景グラデーションを活用
3. **シャドウ**: ネオンエフェクトとサイバーグローを適切に使用
4. **アニメーション**: カスタムアニメーションで動的な体験を提供

### スタイリング規則

1. **一貫性**: 全コンポーネントで統一されたクラス命名とスタイリング
2. **レスポンシブ**: モバイルファーストアプローチ
3. **パフォーマンス**: 必要最小限のCSSクラスの使用
4. **アクセシビリティ**: 適切なコントラスト比とキーボードナビゲーション

## デプロイメント

### ビルド

```bash
npm run build
```

### 本番環境での実行

```bash
npm start
```

## トラブルシューティング

### よくある問題と解決方法

1. **Tailwindクラスが適用されない**
   - `tailwind.config.ts`の設定を確認
   - CSSのビルドとキャッシュクリア

2. **アニメーションが動作しない**
   - ブラウザの設定で動画を有効にする
   - CSSアニメーションの対応確認

## 今後の改善計画

### 実装済み改善 ✅

1. **デザインシステムの統一**
   - [x] フューチャリスティック・サイバーテーマの導入
   - [x] 統一されたカラーパレットとグラデーション
   - [x] カスタムシャドウとネオンエフェクト
   - [x] 一貫したアニメーションシステム

2. **コンポーネントの視覚的向上**
   - [x] ControlAircraft: グラデーションとスキャンエフェクト
   - [x] SelectFixMode: 状態別ボタンデザイン
   - [x] RouteInfoDisplaySetting: カスタムチェックボックス
   - [x] SectorSelector: ネオンドロップダウン
   - [x] DisplayRangeSetting: ビジュアルレンジバー
   - [x] オペレーターボタン: 統一されたサイバーテーマ

### TODO: 実装の改善点

#### パフォーマンス最適化

1. **RadarCanvasコンポーネント**
   - [ ] 不要な再レンダリングの削減
     - `useMemo`と`useCallback`を使用して関数と計算結果をメモ化
     - コンポーネントをより小さな単位に分割
   - [ ] レンダリングループの最適化
     - `requestAnimationFrame`の使用を最適化
     - フレームレート制御の実装
   - [ ] キャンバス描画の最適化
     - ダブルバッファリングの実装を改善
     - 描画領域の最適化（表示範囲外の描画をスキップ）

2. **状態管理の改善**
   - [ ] Contextの最適化
     - 不要なContextの分割
     - 状態更新の最適化
   - [ ] 型定義の強化
     - `any`型の使用を排除
     - より厳密な型定義の実装

### TODO: 管制レーダーシステムとして必要な機能

現在のシステムは基本的な航空機追跡と制御機能を提供していますが、実用的なATC（航空管制）システムとして以下の重要な機能が不足しています。これらの機能は航空安全の確保と効率的な航空交通管理のために不可欠です。

#### 1. 安全管理・監視機能 🚨

**1.1 航空機間隔監視システム**
- [ ] **最小分離距離監視**: 水平5NM、垂直1000ftの分離基準監視
- [ ] **衝突危険アラート**: 接近する航空機への視覚・音声警告
- [ ] **分離違反記録**: 分離基準違反の自動記録とレポート生成
- **必要な理由**: 航空安全の最も基本的な要件。衝突防止は管制官の最優先任務

**1.2 緊急事態対応システム**
- [ ] **Emergency Squawk Code対応**: 7500(ハイジャック)、7600(無線機故障)、7700(緊急事態)の自動検知
- [ ] **緊急事態プロトコル**: 緊急時の優先ルーティングと手順ガイダンス
- [ ] **緊急事態ログ**: 全ての緊急事態対応の詳細記録
- **必要な理由**: 緊急事態時の迅速で適切な対応は人命に直結する

**1.3 気象情報統合システム**
- [ ] **リアルタイム気象データ**: 風向、風速、視界、雲高、降水量の表示
- [ ] **気象警報**: 悪天候エリアの視覚的ハイライトと回避ルート提案
- [ ] **ウィンドシア検知**: 危険なウィンドシアの検知と警告
- **必要な理由**: 気象は飛行安全に最も影響する要因。適切な気象情報なしに安全な管制は不可能

#### 2. 通信・記録機能 📡

**2.1 音声通信システム**
- [ ] **パイロット-管制官通信**: 音声通信の録音と再生機能
- [ ] **通信履歴表示**: 各航空機との交信記録の時系列表示
- [ ] **標準フレーズ支援**: ICAO標準フレーズの自動生成とテンプレート
- **必要な理由**: 管制指示の確実な伝達と記録は法的要件であり、事故調査時の重要証拠

**2.2 包括的ログシステム**
- [ ] **全管制指示記録**: 時刻、航空機、指示内容の完全ログ
- [ ] **システム操作ログ**: 管制官の全ての操作履歴
- [ ] **データ再生機能**: 過去の管制状況の完全再現
- **必要な理由**: 航空法規制により全ての管制活動の記録保持が義務付けられている

#### 3. フライト管理機能 ✈️

**3.1 高度なフライトプラン管理**
- [ ] **フライトプラン表示**: 詳細な飛行計画の表示と編集
- [ ] **ルート変更管理**: 飛行経路変更の承認ワークフロー
- [ ] **ETA計算**: 各ウェイポイントの予想到着時刻自動計算
- **必要な理由**: 効率的な交通流管理とスロット管理に必須

**3.2 航空機性能データベース**
- [ ] **機種別性能データ**: 上昇率、降下率、巡航速度等の詳細データ
- [ ] **燃料消費予測**: 航続可能距離と代替空港選択支援
- [ ] **重量・バランス考慮**: 離着陸性能への重量影響計算
- **必要な理由**: 適切な管制指示には航空機の性能限界の理解が不可欠

#### 4. 空域・空港管理機能 🛫

**4.1 空域管理システム**
- [ ] **セクター境界表示**: 管制区域の明確な境界線表示
- [ ] **高度制限表示**: 各空域の最低・最高高度制限情報
- [ ] **特別空域情報**: 禁止区域、制限区域、危険区域の表示
- **必要な理由**: 空域侵犯防止と適切な高度配分のために必須

**4.2 空港・滑走路管理**
- [ ] **滑走路状態情報**: 使用可能滑走路と閉鎖情報のリアルタイム表示
- [ ] **地上交通管理**: 空港内での航空機移動状況追跡
- [ ] **離着陸スロット管理**: 離着陸時刻の最適化とコンフリクト回避
- **必要な理由**: 空港容量の最適活用と地上での航空機安全確保

#### 5. ナビゲーション支援機能 🧭

**5.1 航法援助施設詳細情報**
- [ ] **VOR/NDB詳細データ**: 周波数、識別信号、有効範囲の詳細表示
- [ ] **ILS進入情報**: 計器着陸システムの詳細パラメータ
- [ ] **GPS/RNAV経路**: 高精度航法経路の詳細情報
- **必要な理由**: パイロットへの正確な航法指示のために必要

**5.2 進入・出発手順管理**
- [ ] **SID/STAR表示**: 標準計器出発・到着経路の詳細表示
- [ ] **進入手順支援**: 計器進入手順のステップバイステップガイド
- [ ] **代替進入提案**: 気象条件に応じた最適進入方式の提案
- **必要な理由**: 複雑な進入・出発手順の正確な管理は安全運航の要

#### 6. システム運用・保守機能 🔧

**6.1 冗長性・バックアップシステム**
- [ ] **システム冗長化**: プライマリ・セカンダリシステムの自動切替
- [ ] **データバックアップ**: リアルタイムデータの自動バックアップ
- [ ] **障害時手順**: システム障害時の代替運用手順
- **必要な理由**: 24時間365日の確実な運用が求められる重要インフラ

**6.2 管制官支援機能**
- [ ] **ワークロード監視**: 管制官の作業負荷測定と最適化提案
- [ ] **訓練モード**: 新人管制官向けの訓練シナリオ機能
- [ ] **ヒューマンエラー防止**: 潜在的ミスの予測と警告システム
- **必要な理由**: 人的要因による事故防止と管制品質の向上

#### 7. 音響・視覚警告システム 🔊

**7.1 多層警告システム**
- [ ] **音声アラート**: 危険度に応じた異なる音声警告
- [ ] **視覚的警告**: 色分けされた視覚アラートとフラッシュ表示
- [ ] **段階的エスカレーション**: 警告レベルの自動エスカレーション
- **必要な理由**: 管制官の注意を確実に引くための冗長な警告システム

**7.2 状況認識支援**
- [ ] **トレンド表示**: 航空機の将来位置予測表示
- [ ] **コンフリクト予測**: 潜在的なコンフリクトの事前警告
- [ ] **作業負荷インジケータ**: 現在の管制密度と複雑さの視覚化
- **必要な理由**: 管制官の状況認識能力向上による予防的安全管理

### 実装優先度

**Phase 1 (高優先度)**: 安全に直結する機能
- 航空機間隔監視システム
- 緊急事態対応システム
- 基本的な音声通信システム

**Phase 2 (中優先度)**: 運用効率向上機能
- フライトプラン管理
- 気象情報統合
- ログシステム

**Phase 3 (低優先度)**: 高度な支援機能
- 航空機性能データベース
- 訓練モード
- 高度な予測システム

これらの機能の実装により、本システムは教育用シミュレータから実用レベルのATC訓練システムへと発展させることができます。

## 貢献ガイドライン

1. デザインシステムの一貫性を保つ
2. 新しいコンポーネントは既存のテーマに従う
3. アニメーションは控えめで意味のあるものにする
4. テストとドキュメントの更新

## ライセンス

このプロジェクトはオープンソースとして公開されており、研究・教育目的で自由に利用できます。
